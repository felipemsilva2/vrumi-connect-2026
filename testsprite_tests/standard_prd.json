{
  "meta": {
    "project": "EduDriver SaaS Platform",
    "date": "2025-11-14",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "EduDriver is a SaaS educational platform aimed at individuals preparing for driving license exams and licensed instructors offering practical lessons. It integrates study tools like theoretical courses, flashcards, and simulados with a future marketplace facilitating the connection between students and instructors across cities and states.",
  "core_goals": [
    "Provide autonomous, quick, and cost-effective learning tools based on official DETRAN content.",
    "Enable users to prepare comprehensively for driving exams through theoretical study, practice tests, and flashcard revision.",
    "Offer a secure, centralized, and accessible platform for the entire driver license preparation process.",
    "Facilitate connection and engagement between students and licensed instructors by location.",
    "Ensure a responsive and user-friendly interface adaptable to multiple devices.",
    "Support multiple user roles, including students and instructors, with distinct operational flows."
  ],
  "key_features": [
    "User authentication and account management via email/password login.",
    "Theoretical course content delivery including videos and texts.",
    "Flashcards for quick concept review with performance tracking.",
    "Simulados with automatic correction and scoring reflecting official exam patterns.",
    "User progress dashboard showing study time, performance, and review suggestions.",
    "Stripe-based payment processing supporting individual and family pass plans.",
    "Admin tools for manual pass creation and import of educational materials.",
    "AI-powered study chat with contextual responses based on PDFs.",
    "Automatic generation of quiz questions and flashcards from PDFs using AI.",
    "Batch import of traffic signs with images and structured data.",
    "Marketplace search and booking for practical driving lessons (planned for V1).",
    "Compliance with data protection standards like LGPD with explicit consent workflows."
  ],
  "user_flow_summary": [
    "Student registers and selects a plan (free or paid).",
    "Student accesses study modules: courses, flashcards, simulados.",
    "Student completes modules and views progress on dashboard.",
    "Student utilizes AI chat for contextual study assistance based on PDFs.",
    "Post-completion, student may search and book practical instructors (planned).",
    "Instructors register profile with location, vehicle type, pricing.",
    "Instructors appear in regional searches and receive bookings and reviews.",
    "Admin users manage passes, educational content, and audit logs."
  ],
  "validation_criteria": [
    "Users can log in using email and password within 10 seconds.",
    "UI is fully responsive and readable across major mobile resolutions.",
    "Flashcard interactions save progress persistently in the database.",
    "Simulados auto-correct and calculate a final exam score percentage accurately.",
    "User progress updates automatically after each study module completion.",
    "Stripe checkout processes complete with confirmation and notification emails.",
    "Data privacy policies are acknowledged and consented to before registration.",
    "All error messages are user-friendly without exposing technical details."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React (Vite)",
      "Supabase Postgres",
      "TailwindCSS, Radix UI, React Router, React Query, Stripe"
    ],
    "features": [
      {
        "name": "create-checkout",
        "description": "Inicia sessão de pagamento no Stripe para comprar passaportes (individual/família).",
        "files": [
          "src/pages/Checkout.tsx",
          "src/components/PricingSection.tsx",
          "supabase/functions/create-checkout/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Create Checkout",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/create-checkout": {
              "post": {
                "summary": "Cria sessão de checkout Stripe",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "passType": {
                            "type": "string",
                            "enum": [
                              "individual_30_days",
                              "individual_90_days",
                              "family_90_days"
                            ]
                          },
                          "secondUserEmail": {
                            "type": "string",
                            "nullable": true
                          }
                        },
                        "required": [
                          "passType"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Sessão criada",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "url": {
                              "type": "string"
                            },
                            "sessionId": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  },
                  "500": {
                    "description": "Erro ao criar sessão"
                  }
                }
              }
            }
          },
          "components": {
            "securitySchemes": {
              "bearerAuth": {
                "type": "http",
                "scheme": "bearer"
              }
            }
          }
        }
      },
      {
        "name": "verify-payment",
        "description": "Verifica pagamento no Stripe e cria passes no banco (inclui plano família).",
        "files": [
          "src/pages/CheckoutSuccess.tsx",
          "supabase/functions/verify-payment/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Verify Payment",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/verify-payment": {
              "post": {
                "summary": "Verifica sessão e ativa passaportes",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "sessionId": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "sessionId"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Pagamento verificado"
                  },
                  "400": {
                    "description": "Pagamento não concluído"
                  },
                  "500": {
                    "description": "Erro interno"
                  }
                }
              }
            }
          },
          "components": {
            "securitySchemes": {
              "bearerAuth": {
                "type": "http",
                "scheme": "bearer"
              }
            }
          }
        }
      },
      {
        "name": "study-chat",
        "description": "Chat de estudo com IA usando contexto do PDF atual.",
        "files": [
          "src/pages/StudyRoom.tsx",
          "supabase/functions/study-chat/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Study Chat",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/study-chat": {
              "post": {
                "summary": "Responde mensagem do usuário com IA",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "message": {
                            "type": "string"
                          },
                          "pdfContext": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "message"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Resposta gerada",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "message": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "generate-questions",
        "description": "Gera questões de múltipla escolha via IA a partir de PDF e salva em \"quiz_questions\".",
        "files": [
          "src/pages/AdminQuestions.tsx",
          "supabase/functions/generate-questions/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Generate Questions",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/generate-questions": {
              "post": {
                "summary": "Gera e persiste questões",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "pdfBase64": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pdfBase64"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Quantidade gerada"
                  },
                  "500": {
                    "description": "Erro interno"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "generate-flashcards",
        "description": "Gera flashcards via IA a partir de PDF e salva em \"flashcards\".",
        "files": [
          "src/pages/AdminFlashcards.tsx",
          "supabase/functions/generate-flashcards/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Generate Flashcards",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/generate-flashcards": {
              "post": {
                "summary": "Gera e persiste flashcards",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "pdfBase64": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pdfBase64"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Quantidade gerada"
                  },
                  "500": {
                    "description": "Erro interno"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "import-traffic-signs",
        "description": "Importa placas em lote: baixa imagens, envia ao Storage e upsert em \"traffic_signs\".",
        "files": [
          "src/pages/admin/AdminTrafficSignsImport.tsx",
          "supabase/functions/import-traffic-signs/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Import Traffic Signs",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/import-traffic-signs": {
              "post": {
                "summary": "Importa placas de trânsito",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "signs": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "code": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "image_url": {
                                  "type": "string"
                                },
                                "description": {
                                  "type": "string"
                                },
                                "category": {
                                  "type": "string"
                                }
                              },
                              "required": [
                                "code",
                                "name",
                                "image_url",
                                "category"
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Resumo da importação"
                  },
                  "500": {
                    "description": "Erro interno"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "populate-materiais-from-pdf",
        "description": "Extrai e estrutura conteúdo de PDF em blocos didáticos para \"lesson_contents\".",
        "files": [
          "src/components/admin/PopulateMateriaisFromPDF.tsx",
          "supabase/functions/populate-materiais-from-pdf/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Populate Materiais From PDF",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/populate-materiais-from-pdf": {
              "post": {
                "summary": "Cria blocos de conteúdo da lição",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "lessonId": {
                            "type": "string"
                          },
                          "pdfContent": {
                            "type": "string"
                          },
                          "chapterContext": {
                            "type": "object"
                          }
                        },
                        "required": [
                          "lessonId",
                          "pdfContent"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Blocos criados"
                  },
                  "500": {
                    "description": "Erro interno"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "admin-create-pass",
        "description": "Admin cria passes manualmente (individual ou família), com auditoria.",
        "files": [
          "src/components/admin/CreatePassDialog.tsx",
          "supabase/functions/admin-create-pass/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Admin Create Pass",
            "version": "1.0.0"
          },
          "paths": {
            "/functions/v1/admin-create-pass": {
              "post": {
                "summary": "Cria passaporte para usuário(s)",
                "security": [
                  {
                    "bearerAuth": []
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "user_email": {
                            "type": "string"
                          },
                          "second_user_email": {
                            "type": "string"
                          },
                          "pass_type": {
                            "type": "string",
                            "enum": [
                              "30_days",
                              "90_days",
                              "family_90_days"
                            ]
                          },
                          "expires_at": {
                            "type": "string"
                          },
                          "price": {
                            "type": "number"
                          }
                        },
                        "required": [
                          "user_email",
                          "pass_type",
                          "expires_at",
                          "price"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Passes criados"
                  },
                  "400": {
                    "description": "Erro/sem permissão"
                  }
                }
              }
            }
          },
          "components": {
            "securitySchemes": {
              "bearerAuth": {
                "type": "http",
                "scheme": "bearer"
              }
            }
          }
        }
      },
      {
        "name": "RPC: get_category_progress / update_user_sign_progress / save_challenge_result / is_admin / log_admin_action",
        "description": "Funções RPC de progresso, resultados de desafio, verificação de admin e auditoria.",
        "files": [
          "src/components/traffic-signs/FlashcardMode.tsx",
          "src/components/traffic-signs/TimedChallenge.tsx",
          "src/hooks/useIsAdmin.ts",
          "src/hooks/useAuditLog.ts",
          "supabase/functions/admin-create-pass/index.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Supabase RPC Functions",
            "version": "1.0.0"
          },
          "paths": {
            "/rpc/get_category_progress": {
              "post": {
                "summary": "Progresso por categoria",
                "responses": {
                  "200": {
                    "description": "Métricas de progresso"
                  }
                }
              }
            },
            "/rpc/update_user_sign_progress": {
              "post": {
                "summary": "Atualiza progresso de placa",
                "responses": {
                  "200": {
                    "description": "OK"
                  }
                }
              }
            },
            "/rpc/save_challenge_result": {
              "post": {
                "summary": "Salva resultado de desafio",
                "responses": {
                  "200": {
                    "description": "OK"
                  }
                }
              }
            },
            "/rpc/is_admin": {
              "post": {
                "summary": "Verifica se usuário é admin",
                "responses": {
                  "200": {
                    "description": "true/false"
                  }
                }
              }
            },
            "/rpc/log_admin_action": {
              "post": {
                "summary": "Audita ação administrativa",
                "responses": {
                  "200": {
                    "description": "ID de log"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
